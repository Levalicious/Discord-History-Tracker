javascript:(function(){var s=function(){function c(){return f.i("messagesWrapper")}function u(){return c().querySelector("[class*='scroller-']")}function i(){return c().querySelectorAll("[class*='message-']")}function r(t){var e=Object.keys(t||{}),n=e.find(t=>t.startsWith("__reactInternalInstance"));return n?t[n].memoizedProps:(n=e.find(t=>t.startsWith("__reactProps$")))?t[n]:null}function o(t){var e=r(t);if(e.children&&e.children.length)for(let t=3;t<e.children.length;t++){var n=e.children[t].props;if(n&&"message"in n&&"channel"in n)return n}return null}function d(){return null===document.querySelector("#messagesNavigationDescription + [class^=container]")}function h(){try{const e=[];for(const n of i())try{var t=o(n);null!=t&&e.push(t.message)}catch(t){console.error("[DHT] Error extracing message data, skipping it.",t,n,function(t){try{return this.o(t)}catch(t){return null}}(n))}return e}catch(t){return console.error("[DHT] Error retrieving messages.",t),[]}}return{l:function(s){let a=0,i=!1,o=!1;const l=new Set,t=window.setInterval(()=>{if(0<a)--a;else if(c()){var e=f.i("message",c());if(300<(e?e.parentElement.children.length:0)){if(i)return;a=3,i=!0,window.setTimeout(()=>{const t=u();t.scrollTop=t.scrollHeight/2},1)}else i=!1;e=h();let t=!1;for(const n of e)if(!l.has(n.id)){t=!0;break}if(t){l.clear();for(const r of e)l.add(r.id);o=!1,s(e)}else o||d()||(o=!0,s(!1))}else a=2},200);window.h.push(()=>window.clearInterval(t))},o:r,g:function(){try{let n;for(const e of i()){var t=o(e);if(null!=t){n=t.channel;break}}if(!n)return null;var r=f.i("privateChannels");if(r){let t;for(const a of r.querySelectorAll("[class*='channel-'] [class*='selected-'] [class^='name-'] *, [class*='channel-'][class*='selected-'] [class^='name-'] *")){var s=Array.prototype.find.call(a.childNodes,t=>t.nodeType===Node.TEXT_NODE);if(s){t=s.nodeValue;break}}if(!t)return null;let e;switch(n.type){case 1:e="DM";break;case 3:e="GROUP";break;default:return null}return{server:t,channel:t,id:n.id,type:e,extra:{}}}return n.guild_id?{server:document.querySelector("nav header h1[class*='name-']").innerText,channel:n.name,id:n.id,type:"SERVER",extra:{position:n.position,topic:n.topic,nsfw:n.nsfw}}:null}catch(t){return console.error(t),null}},p:h,v:()=>!!c(),k:d,S:function(){let t=u();0<t.scrollTop&&(t.scrollTop=0)},T:function(){var t=f.i("privateChannels");if(t){const e=f.i("selected",t);t=e&&e.closest("[class*='channel-']");const r=t&&t.nextElementSibling;if(!r||!r.getAttribute("class").includes("channel-"))return!1;const s=r.querySelector("a[href*='/@me/']");return s?(s.click(),s.scrollIntoView(!0),!0):!1}{const a=document.getElementById("channels");if(!a)return!1;function n(t){return t.querySelector("a[href^='/channels/'][role='link']")}const i=Array.prototype.filter.call(a.querySelectorAll("[class*='containerDefault']"),t=>null!==n(t));let e=null;for(let t=0;t<i.length-1;t++)if(i[t].className.includes("selected-")){e=i[t+1];break}if(null===e)return!1;const o=n(e);return o?(o.click(),e.scrollIntoView(!0),!0):!1}}}}(),f=function(){var s=(t,e,n,r)=>{t=document.createElement(t);return t.id=n||"",t.innerHTML=r||"",e.appendChild(t),t};return{id:(t,e)=>(e||document).getElementById(t),i:(t,e)=>(e||document).querySelector(`[class*="${t}-"]`),createElement:(t,e,n,r)=>s(t,e,n,r),C:t=>t.parentNode.removeChild(t),O:t=>s("style",document.head,"",t),A:(t,e)=>window.setTimeout(t,e),M:(t,e,n)=>t.addEventListener(e,n),D:(t,e,n)=>{n=new Date(Date.now()+1e3*n).toUTCString();document.cookie=t+"="+encodeURIComponent(JSON.stringify(e))+";path=/;expires="+n},N:t=>{t=document.cookie.replace(new RegExp("(?:(?:^|.*;\\s*)"+t+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1");return t.length?JSON.parse(decodeURIComponent(t)):null},R:(t,e)=>{var n=new Blob([e],{type:"octet/stream"});if("msSaveBlob"in window.navigator)return window.navigator.msSaveBlob(n,t);e=window.URL.createObjectURL(n),n=s("a",document.body);n.href=e,n.download=t,n.style.display="none",n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(e)}}}(),t=function(){function e(t){r||(h.F(n),d.$(n),r=!0),n("gui",t)}var i,o,l=()=>{h._()?(i.I.U.disabled=!0,i.I.j.disabled=!0,i.I.P.disabled=!0):(i.I.U.disabled=!1,i.I.j.disabled=!1,i.I.H.disabled=i.I.P.disabled=!h.L())},n=(t,e)=>{var n,r,s,a;i&&(s="gui"===t&&"controller"===e,"data"!==t&&!s||l(),"tracking"!==t&&!s||(l(),i.I.J.innerHTML=h._()?"Pause Tracking":"Start Tracking"),"data"!==t&&!s||(r=n=0,h.L()&&(n=h.V().G(),r=h.V().W()),i.I.B.innerHTML=[n," message",1===n?"":"s"," from ",r," channel",1===r?"":"s"].join(""))),o&&((s="gui"===t&&"settings"===e)&&(o.I.q.checked=d.autoscroll,o.I.X[d.afterFirstMsg].checked=!0,o.I.K[d.afterSavedMsg].checked=!0),"setting"!==t&&!s||(a=!d.autoscroll,Object.values(o.I.X).forEach(t=>t.disabled=a),Object.values(o.I.K).forEach(t=>t.disabled=a)))},r=!1,s={Y:function(){(i={}).Z=f.O(` #app-mount div[class*="app-"] { margin-bottom: 48px !important; } #dht-ctrl { position: absolute; bottom: 0; width: 100%; height: 48px; background-color: #FFF; z-index: 1000000; } #dht-ctrl button { height: 32px; margin: 8px 0 8px 8px; font-size: 16px; padding: 0 12px; background-color: #7289DA; color: #FFF; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.75); } #dht-ctrl button:disabled { background-color: #7A7A7A; cursor: default; } #dht-ctrl-close { margin: 8px 8px 8px 0 !important; float: right; } #dht-ctrl p { display: inline-block; margin: 14px 12px; } #dht-ctrl input { display: none; }`);var t=(t,e)=>"<button id='dht-ctrl-"+t+"'>"+e+"</button>";i.tt=f.createElement("div",document.body,"dht-ctrl",` ${t("upload","Upload &amp; Combine")} ${t("settings","Settings")} ${t("track","")} ${t("download","Download")} ${t("reset","Reset")} <p id='dht-ctrl-status'></p> <input id='dht-ctrl-upload-input' type='file' multiple> ${t("close","X")}`),i.I={U:f.id("dht-ctrl-upload"),j:f.id("dht-ctrl-settings"),J:f.id("dht-ctrl-track"),H:f.id("dht-ctrl-download"),P:f.id("dht-ctrl-reset"),et:f.id("dht-ctrl-close"),B:f.id("dht-ctrl-status"),nt:f.id("dht-ctrl-upload-input")},f.M(i.I.U,"click",()=>{i.I.nt.click()}),f.M(i.I.j,"click",()=>{s.rt()}),f.M(i.I.J,"click",()=>{h.st(!h._())}),f.M(i.I.H,"click",()=>{h.at()}),f.M(i.I.P,"click",()=>{h.it()}),f.M(i.I.et,"click",()=>{s.ot(),window.h.forEach(t=>t()),window.DHT_LOADED=!1}),f.M(i.I.nt,"change",()=>{Array.prototype.forEach.call(i.I.nt.files,e=>{var n=new FileReader;n.onload=function(){var t={};try{t=JSON.parse(n.result)}catch(t){return alert("Could not parse '"+e.name+"', see console for details."),void console.error(t)}c.lt(t)?h.ct(e.name,new c(t)):alert("File '"+e.name+"' has an invalid format.")},n.readAsText(e,"UTF-8")}),i.I.nt.value=null}),e("controller")},ot:function(){i&&(f.C(i.tt),f.C(i.Z),i=null)},rt:function(){(o={}).Z=f.O(` #dht-cfg-overlay { position: absolute; left: 0; top: 0; width: 100%; height: 100%; background-color: #000; opacity: 0.5; display: block; z-index: 1000001; } #dht-cfg { position: absolute; left: 50%; top: 50%; width: 800px; height: 262px; margin-left: -400px; margin-top: -131px; padding: 8px; background-color: #fff; z-index: 1000002; } #dht-cfg-note { margin-top: 22px; } #dht-cfg sub { color: #666; font-size: 13px; }`),o.ut=f.createElement("div",document.body,"dht-cfg-overlay"),f.M(o.ut,"click",()=>{s.dt()});var t=(t,e,n)=>"<label><input id='dht-cfg-"+t+"-"+e+"' name='dht-"+t+"' type='radio'> "+n+"</label><br>";o.tt=f.createElement("div",document.body,"dht-cfg",` <label><input id='dht-cfg-autoscroll' type='checkbox'> Autoscroll</label><br> <br> <label>After reaching the first message in channel...</label><br> ${t("afm","nothing","Do Nothing")} ${t("afm","pause","Pause Tracking")} ${t("afm","switch","Switch to Next Channel")} <br> <label>After reaching a previously saved message...</label><br> ${t("asm","nothing","Do Nothing")} ${t("asm","pause","Pause Tracking")} ${t("asm","switch","Switch to Next Channel")} <p id='dht-cfg-note'> It is recommended to disable link and image previews to avoid putting unnecessary strain on your browser.<br><br> <sub>v.31d, released 19 June 2022</sub> </p>`),o.I={q:f.id("dht-cfg-autoscroll"),X:{},K:{}},o.I.X[u.ht]=f.id("dht-cfg-afm-nothing"),o.I.X[u.ft]=f.id("dht-cfg-afm-pause"),o.I.X[u.gt]=f.id("dht-cfg-afm-switch"),o.I.K[u.ht]=f.id("dht-cfg-asm-nothing"),o.I.K[u.ft]=f.id("dht-cfg-asm-pause"),o.I.K[u.gt]=f.id("dht-cfg-asm-switch"),o.I.q.addEventListener("change",()=>{d.autoscroll=o.I.q.checked}),Object.keys(o.I.X).forEach(t=>{f.M(o.I.X[t],"click",()=>{d.afterFirstMsg=t})}),Object.keys(o.I.K).forEach(t=>{f.M(o.I.K[t],"click",()=>{d.afterSavedMsg=t})}),e("settings")},dt:function(){o&&(f.C(o.ut),f.C(o.tt),f.C(o.Z),o=null)}};return s}();class c{constructor(t){var e=this;c.lt(t)||(t={meta:{},data:{}}),e.meta=t.meta,e.data=t.data,e.meta.users=e.meta.users||{},e.meta.userindex=e.meta.userindex||[],e.meta.servers=e.meta.servers||[],e.meta.channels=e.meta.channels||{},e.vt={wt:{},bt:new Set,kt:new Set,yt:new Set}}static lt(t){return t&&"object"==typeof t.meta&&"object"==typeof t.data}St(e,t,n,r){var s=e in this.meta.users,a=s?this.meta.users[e]:{};return a.name=t,n&&(a.tag=n),r&&(a.avatar=r),s?e in this.vt.wt?this.vt.wt[e]:this.vt.wt[e]=this.meta.userindex.findIndex(t=>t==e):(this.meta.users[e]=a,this.meta.userindex.push(e),this.vt.wt[e]=this.meta.userindex.length-1)}xt(e,n){var t=this.meta.servers.findIndex(t=>t.name===e&&t.type===n);return-1===t?(this.meta.servers.push({name:e,type:n}),this.meta.servers.length-1):t}Tt(t,e,n,r){if(this.meta.servers[t]){var s=e in this.meta.channels,t=s?this.meta.channels[e]:{server:t};return t.name=n,r.position&&(t.position=r.position),r.topic&&(t.topic=r.topic),r.nsfw&&(t.nsfw=r.nsfw),!s&&(this.meta.channels[e]=t,this.vt.bt.add(e),!0)}}Ct(t,e,n){var r=this.data[t]||(this.data[t]={}),t=e in r;return r[e]=n,this.vt.kt.add(e),!t}Ot(t){var e=t.author,e={u:this.St(e.id,e.username,e.bot?null:e.discriminator,e.avatar),t:t.timestamp.toDate().getTime()};return 0<t.content.length&&(e.m=t.content),null!==t.editedTimestamp&&(e.te=t.editedTimestamp.toDate().getTime()),0<t.embeds.length&&(e.e=t.embeds.map(t=>{let e={url:t.url,type:t.type};return"rich"===t.type&&Array.isArray(t.title)&&1===t.title.length&&"string"==typeof t.title[0]&&(e.t=t.title[0],Array.isArray(t.description)&&1===t.description.length&&"string"==typeof t.description[0]&&(e.d=t.description[0])),e})),0<t.attachments.length&&(e.a=t.attachments.map(t=>({url:t.url}))),null!==t.messageReference&&(e.r=t.messageReference.message_id),0<t.reactions.length&&(e.re=t.reactions.map(t=>{let e={c:t.count,n:t.emoji.name};return null!==t.emoji.id&&(e.id=t.emoji.id),t.emoji.animated&&(e.an=!0),e})),e}At(t){return this.vt.yt.has(t)}Mt(t,e){var n,r=!1;for(n of e){var s=n.type;0!==s&&19!==s||"SENT"!==n.state||!this.Ct(t,n.id,this.Ot(n))||(this.vt.yt.add(n.id),r=!0)}return r}W(){return this.vt.bt.size}G(){return this.vt.kt.size}Dt(t){var e,n,r,s={},a=!1;for(e in t.meta.users){var i=t.meta.users[e];s[t.meta.userindex.findIndex(t=>t==e)]=this.St(e,i.name,i.tag,i.avatar)}for(n in t.meta.channels){var o=t.meta.servers[t.meta.channels[n].server],l=t.meta.channels[n];this.Tt(this.xt(o.name,o.type),n,l.name,l)}for(n in t.data)for(r in l=t.data[n]){var c=l[r];(i=c.u)in s?(c.u=s[i],this.Ct(n,r,c)):(a||(a=!0,alert("The uploaded archive appears to be corrupted, some messages will be skipped. See console for details."),console.error("User list:",t.meta.users),console.error("User index:",t.meta.userindex),console.error("Generated mapping:",s),console.error("Missing user for the following messages:")),console.error(c))}}Nt(){return JSON.stringify({meta:this.meta,data:this.data})}}var u={ht:"optNothing",ft:"optPause",gt:"optSwitch"},r=!1,d=function(){function s(){f.D("DHT_SETTINGS",e,15768e4)}function t(e,n,t){var r="_"+n;Object.defineProperty(e,n,{get:()=>e[r],set:t=>{e[r]=t,function(t,e){for(var n of a)n(t,e);s()}("setting",n)}}),e[r]=t}var e={},a=[],n=f.N("DHT_SETTINGS");return n||(n={_autoscroll:!0,_afterFirstMsg:u.ft,_afterSavedMsg:u.ft},r=!0),t(e,"autoscroll",n._autoscroll),t(e,"afterFirstMsg",n._afterFirstMsg),t(e,"afterSavedMsg",n._afterSavedMsg),e.$=function(t){a.push(t)},r&&s(),e}(),h=function(){function a(t,e){for(var n of r)n(t,e)}var r=[];return new class{constructor(){this.it()}it(){this.Rt=null,this.Ft=!1,this.$t=null,a("data","reset")}V(){return this.Rt||(this.Rt=new c),this.Rt}L(){return null!=this.Rt}_(){return this.Ft}st(t){this.Ft=t,a("tracking",t)}ct(t,e){this.$t=t,this.V().Dt(e),a("data","upload")}at(){this.L()&&f.R(this.$t||"dht.txt",this.Rt.Nt())}_t(t,e,n,r,s){e=this.V().xt(t,e);!0===this.V().Tt(e,n,r,s)&&a("data","channel")}Ut(t,e){return!!this.V().Mt(t,e)&&(a("data","messages"),!0)}At(t){return this.V().At(t)}F(t){r.push(t)}}}();const e=window.location.href;if(!e.includes("discord.com/")&&!e.includes("discordapp.com/")&&!confirm("Could not detect Discord in the URL, do you want to run the script anyway?"))return;if(window.DHT_LOADED)return void alert("Discord History Tracker is already loaded.");window.DHT_LOADED=!0,window.h=[];let a=new Set,i=null,o=function(t){a.add("stopping"),f.A(()=>{h.st(!1),a.delete("stopping"),t&&t()},200)};s.l(t=>{if(h._()&&0===a.size){let n=s.g();if(n)if(h._t(n.server,n.type,n.id,n.channel,n.extra),!1===t||t.length){var r=!1!==t&&h.Ut(n.id,t);if(d.autoscroll){let e=null;!1===t?e=d.afterFirstMsg:r||h.At(t[0].id)||(e=d.afterSavedMsg),null===e?i=r?(s.S(),window.clearTimeout(i),null):window.setTimeout(s.S,2500):(a.add("stalling"),f.A(()=>{a.delete("stalling");var t=s.g();!t||t.id!==n.id||null!=(t=s.p())&&h.Ut(n.id,t),(e!==u.gt||s.T())&&e!==u.ft||h.st(!1)},250))}}else s.S();else o()}}),h.F((t,e)=>{"tracking"===t&&e&&((t=s.g())?null!=(e=s.p())?(h._t(t.server,t.type,t.id,t.channel,t.extra),h.Ut(t.id,e),d.autoscroll&&s.v()&&(s.k()?s.S():((e=d.afterFirstMsg)!==u.gt||s.T())&&e!==u.ft||o())):o(()=>alert("Cannot see any messages.")):o(()=>alert("The selected channel is not visible in the channel list.")))}),t.Y(),r&&t.rt();})()